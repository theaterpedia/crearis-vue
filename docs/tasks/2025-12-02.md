# Daily Tasks: December 2, 2025

> This file is the starting-point for a workday. It lists important defaults on how to start a day. It contains both single-tasks that need to be managed as well references to other tasking-documents. It will be updated 2-4 times throughout the day. When the day is over the most important achievements will be summarized on the roadmap-document.

---

## Day Focus
**Auth System Foundation** - Database triggers and owner_id implementation for project auth.

## Quick Start
```bash
cd /home/persona/crearis/crearis-vue
# Verify triggers working:
psql -d crearis_admin_dev -c "SELECT id, r_anonym, r_partner, r_participant, r_member, r_owner FROM posts LIMIT 5;"
```

---

## Tasks

### ‚úÖ Completed Today

#### Track A: Database Triggers (AUTH-SYSTEM-SPEC)
- [x] Migration 045: `configrole` INTEGER column on project_members
- [x] Migration 046: `r_*` columns + `owner_id` on posts/images/projects
- [x] Migration 047: `compute_role_visibility()` trigger function
- [x] Migration 048: Recompute helper functions (fixed for JSONB)
- [x] Verified triggers working (posts show r_member=true, r_owner=true for status=0)

#### Track B: Owner Selection in AddPostPanel
- [x] POST `/api/posts` accepts `owner_id` field
- [x] GET `/api/users?project_id=X` returns project owner + members with `project_role`
- [x] AddPostPanel.vue updated with owner dropdown
- [x] server/types/database.ts updated with new fields

#### Track C: Documentation
- [x] CapabilitiesEditor.vue created (~700 lines)
- [x] Opus-CSS-Conventions.md created
- [x] Opus-Database-Conventions.md created
- [x] AUTH-SYSTEM-SPEC.md updated to v0.5 notes

### ‚è≥ In Progress
- [ ] Alpha-prod deployment and testing (user testing 4 use cases)
- [ ] Migration 048 needs to be run (fixed, ready)

### üìã For Tomorrow
- [ ] Implement usePostStatus composable
- [ ] Connect r_* columns to frontend visibility logic
- [ ] Project cascade triggers (v0.5 note)

---

## Git Progress

| Commit | Summary |
|--------|---------|
| `ec95f4d` | feat: add role visibility triggers and columns for auth system |
| `6d3cf30` | feat: add owner_id support to posts and project users endpoint |
| `ab3ec7f` | fix: minor adjustments to migrations and AddPostPanel |

---

## Testing Notes

### 4 Use Cases Being Tested
1. **Use Case A:** Member sees new/demo posts
2. **Use Case B:** Participant doesn't see new/demo but sees review posts
3. **Use Case C:** User creates post and becomes owner
4. **Use Case D:** Project-owner has member-role on others' records

### Trigger Verification Query
```sql
SELECT id, status, owner_id, r_anonym, r_partner, r_participant, r_member, r_owner 
FROM posts 
ORDER BY id DESC LIMIT 10;
```

---

## References
- [Sprint Roadmap](./2025-12-01-SPRINT-Projectlogin_Workflow.md)
- [AUTH-SYSTEM-SPEC](./2025-12-01-AUTH-SYSTEM-SPEC.md)
- [TDD Plan](./2025-11-30-TDD-IMPLEMENTATION-PLAN.md)
