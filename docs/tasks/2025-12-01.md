# Daily Tasks: December 1, 2025

> This file is the starting-point for a workday. It lists important defaults on how to start a day. It contains both single-tasks that need to be managed as well references to other tasking-documents. It will be updated 2-4 times throughout the day. When the day is over the most important achievements will be summarized on the roadmap-document.

---

## Day Focus
**Auth-System Refactoring**: Define sysreg_config capabilities matrix, create test specifications.

## Quick Start
```bash
cd /home/persona/crearis/crearis-vue
git checkout alpha/projectlogin_workflow
pnpm install
pnpm test  # Run all tests
TEST_MAXV=0.2 pnpm test  # Run v0.2 tests only
```

---

## Tasks

### Morning: Auth-System Specification ✅
- [x] Read and analyze `2025-12-01_initial_prompt.md`
- [x] Research existing auth system (useAuth.ts, login.post.ts, session.get.ts)
- [x] Query database structure (sysreg_config, project_members, projects)
- [x] Create auth-system spec document (`2025-12-01-AUTH-SYSTEM-SPEC.md`)
- [x] Define sysreg_config bit structure (29 bits + sign bit)
- [x] Update `sysreg-bitgroups.json` with new config family

### Afternoon: Test Definitions ✅
- [x] Create `config.roles.spec.ts` with role detection tests
- [x] Create `config.capabilities.spec.ts` with capability tests
- [x] Include v0.5 draft tests for admin role (sign bit)
- [x] Extract v0.5 and v1.1 deferred items to deferred tasks file

### Remaining Work (Afternoon/Evening)
- [x] Run test suite and verify tests pass ✅ (50 passed, 3 skipped)
- [ ] Create `config.matrix.spec.ts` for full matrix resolution
- [ ] Create migration to clear and repopulate sysreg_config
- [ ] Begin `useConfig` composable skeleton

---

## Test Results

```
Test Files  2 passed (2)
Tests  50 passed | 3 skipped (53)
```

### config.roles.spec.ts (22 tests)
- Role Bit Constants: 2 passed, 1 draft (admin v0.5)
- hasRole(): 4 passed
- getRoles(): 4 passed  
- setRoles(): 5 passed
- Role Hierarchy: 2 passed
- Role + Other Bits Integration: 2 passed
- config.roles.admin: 2 draft (v0.5)

### config.capabilities.spec.ts (31 tests)
- Capability Bit Constants: 3 passed
- getCapabilityValue(): 6 passed
- hasSimpleCapability(): 3 passed
- hasCapability() and hasFullCapability(): 2 passed
- getCapabilitySubcategory(): 3 passed
- Capability Inheritance: 6 passed
- Combined Capabilities: 3 passed
- Subcategory Pattern: 3 passed
- config.capabilities.matrix: 2 passed

---

## Files Created Today

| File | Purpose |
|------|---------|
| `docs/tasks/2025-12-01-AUTH-SYSTEM-SPEC.md` | Detailed spec for capabilities matrix |
| `tests/config.roles.spec.ts` | Role bit detection tests |
| `tests/config.capabilities.spec.ts` | Capability detection and inheritance tests |

## Files Modified Today

| File | Change |
|------|--------|
| `src/config/sysreg-bitgroups.json` | Replaced config family with capabilities matrix |
| `docs/tasks/2025-12-10-DEFERRED-from-Projectlogin_Workflow.md` | Added v0.5 and v1.1 items |

---

## Key Decisions Made

### Bit Allocation (29 bits + sign)
| Bits | Purpose |
|------|---------|
| 0-2 | Project type (default/special flag + type) |
| 3-6 | Entity (scope flag + entity type) |
| 7-9 | Record state |
| 10-12 | Read capability |
| 13-15 | Update capability |
| 16-18 | Create capability |
| 19-21 | Manage capability |
| 22-23 | Simple capabilities (list, share) |
| 24-28 | Roles (anonym, partner, participant, member, owner) |
| 31 | Admin role (v0.5, sign bit) |

### Roles (Updated from Prompt)
- Dropped 'recipient' in favor of 'partner'
- Dropped 'all' as redundant
- Moved 'admin' to sign bit (v0.5)
- Final roles: anonym, partner, participant, member, owner

### Capability Inheritance
- read → includes list
- update → includes read, list, share
- create → includes read, list, share  
- manage → includes list, share

---

## References

### Sprint Context
- **Milestone:** v0.2 due Dec 2nd, 16:00
- **Focus:** Core status management + internal project experience
- See [Sprint Roadmap](./2025-12-01-SPRINT-Projectlogin_Workflow.md)

### Key Specifications
- `docs/tasks/2025-12-01-AUTH-SYSTEM-SPEC.md` - Capabilities matrix spec
- `docs/tasks/2025-12-01_initial_prompt.md` - Original requirements

### Key Composables
- `src/composables/useAuth.ts` - Existing auth (to be extended)
- `src/composables/useTagFamily.ts` - Reference for bit operations
- `src/composables/useTagFamilyEditor.ts` - Category→subcategory pattern

---

## Blockers & Questions
<!-- Add any blockers discovered during the day -->

---

## End of Day Summary

### Completed
1. ✅ Auth-system specification created with full 29-bit + sign bit allocation
2. ✅ Role tests: 19 passing, 3 draft (v0.5 admin on sign bit)
3. ✅ Capability tests: 31 passing with inheritance rules validated
4. ✅ Deferred tasks updated with v0.5 and v1.1 items from prompt
5. ✅ Fixed versioned-test syntax: `vDescribe({ version })('name', fn)` pattern

### Key Learnings
- Entity bits need shifting when combined: `0b1100 << 3` not just `0b1100`
- Sign bit (31) produces negative values in JavaScript: `-2147483648`
- Category→subcategory pattern: value 1 = parent/full, value 2+ = subcategory/limited

### Tomorrow (Dec 2)
- Create migration to clear sysreg_config and insert new entries
- Begin useConfig composable implementation
- v0.2 milestone deadline: 16:00
